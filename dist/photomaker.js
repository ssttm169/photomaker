#!/usr/bin/env node
import{_ as e,a as t,P as n,m as r,b as o,c as i,d as a,p as s,e as u}from"./vuepress-93cbd7c8.js";import c from"minimist";import l from"path";import p from"chalk";import*as f from"glob";import v from"fs";import"sharp";var d=f.glob,h=function(e){var t=e.output,n=e.input,i=[];e.files.forEach(function(e){e=e.substring(0,e.lastIndexOf("/")+1);i.push(e.replace(n.replace("./",""),t.replace("./","")))}),(i=(i=Array.from(new Set(o(i)))).filter(function(e){return e})).forEach(function(e){return r(e)})},m=function(){var o=e(t().mark(function o(f){var g,m,b,x,u,l;return t().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return u=void 0===(u=f.ext)?n.ext:u,g=void 0===(l=f.input)?"":l,b=f.webp,v.existsSync(m=f.output)&&v.rmSync(m,{recursive:!0}),r(m),l=d.sync("".concat(g,"/**/*.{").concat(u,"}"),{matchBase:!0}),h({files:l,output:m,input:g}),x=[],l.forEach(function(){var n=e(t().mark(function e(n){var r,o,u,l,c;return t().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.substring(n.lastIndexOf("/"),n.length).substring(1),o=s({webp:b,fullFileName:r})){e.next=4;break}return e.abrupt("return");case 4:u=null==n||null==(u=n.replace(g.replace("./",""),""))?void 0:u.replace(r,""),l="".concat(m).concat(u).concat(o),c=n.substring(n.lastIndexOf(".")+1,n.length),x.push(i(a(a({},f),{},{input:n,output:l,executeExt:c})));case 8:case"end":return e.stop()}},e)}));return function(e){return n.apply(this,arguments)}}()),u=new Date,o.next=10,Promise.allSettled(x);case 10:null!=(l=o.sent)&&l.length&&(console.log(p.green("it spent ".concat(Math.floor(new Date-u)/1e3+"s"))),console.log(p.green("it processed ".concat(l.length," images"))));case 12:case"end":return o.stop()}},o)}));return function(e){return o.apply(this,arguments)}}(),g=c(process.argv.slice(2))||{},b=g.i,x=g.o,w=g.e,y=g.p,S=g.q,k=g.w,z=g.h,q=g.f,P=g.b,E=a({},n);!function(){var e,t={input:b,output:x||".".concat(n.storePath),ext:w||n.ext,webp:y||n.webp,quality:S||n.quality},r=((k||z)&&(t.resize={},k&&(t.resize.width=k),z&&(t.resize.height=z),q&&(t.resize.fit=q),P)&&(t.resize.background=P),l.resolve(l.join(process.cwd(),"pmConfig.json")));if(v.existsSync(r)){try{o=JSON.parse(""+v.readFileSync(r))}catch(e){}o&&(t={input:null==(r=o)?void 0:r.input,output:(null==(r=o)?void 0:r.output)||".".concat(n.storePath),ext:(null==(r=o)?void 0:r.ext)||n.ext,webp:(null==(r=o)?void 0:r.webp)||n.webp,resize:(null==(r=o)?void 0:r.resize)||{},quality:(null==(r=o)?void 0:r.quality)||n.quality})}if(null!=(e=t)&&e.input&&null!=(o=t)&&o.output){if(!v.existsSync(null==(r=t)?void 0:r.input))return console.log(p.red("The input folder does not exist!"));var o=a(a({},E),t),o=u(o);console.log(p.yellow("Photomaker begin to work")),m(o)}else console.log(p.red("The input parameter is not available."))}();
